<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Narra√ß√£o - Developer (Funcionando)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-4">
                <i class="fas fa-microphone mr-3"></i>
                Teste de Narra√ß√£o - Developer Mode
            </h1>
            <p class="text-white/80 text-lg">
                Teste completo da funcionalidade de narra√ß√£o (Modo Offline)
            </p>
        </div>

        <!-- Status -->
        <div class="glass-effect rounded-lg p-6 mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-400 mr-3"></i>
                    <span class="text-white font-semibold">Status:</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-green-400 rounded-full mr-2"></div>
                    <span class="text-white">Modo Offline - Funcionando ‚úÖ</span>
                </div>
            </div>
        </div>

        <!-- Upload de V√≠deo -->
        <div class="glass-effect rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-video mr-2"></i>
                Upload de V√≠deo
            </h2>
            <div class="border-2 border-dashed border-white/30 rounded-lg p-8 text-center">
                <input type="file" id="videoInput" accept="video/*" class="hidden">
                <button onclick="document.getElementById('videoInput').click()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-upload mr-2"></i>
                    Escolher V√≠deo
                </button>
                <p class="text-white/70 mt-2">Formatos suportados: MP4, MOV, AVI</p>
            </div>
            <div id="videoPreview" class="mt-4 hidden">
                <video id="videoPlayer" controls class="w-full rounded-lg" style="max-height: 300px;"></video>
            </div>
        </div>

        <!-- Configura√ß√£o de Narra√ß√£o -->
        <div class="glass-effect rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-microphone mr-2"></i>
                Configura√ß√£o de Narra√ß√£o
            </h2>
            
            <!-- Texto para Narra√ß√£o -->
            <div class="mb-6">
                <label class="block text-white font-semibold mb-2">Texto para Narra√ß√£o:</label>
                <textarea id="narrationText" 
                          class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/50"
                          rows="4" 
                          placeholder="Digite o texto que ser√° narrado no v√≠deo...">Este √© um teste de narra√ß√£o para o v√≠deo. A funcionalidade est√° funcionando perfeitamente!</textarea>
            </div>

            <!-- Configura√ß√µes de Voz -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-white font-semibold mb-2">Tipo de Voz:</label>
                    <select id="voiceType" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white">
                        <option value="male">Masculina</option>
                        <option value="female">Feminina</option>
                        <option value="child">Infantil</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white font-semibold mb-2">Velocidade:</label>
                    <select id="voiceSpeed" class="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white">
                        <option value="0.8">Lenta</option>
                        <option value="1.0" selected>Normal</option>
                        <option value="1.2">R√°pida</option>
                    </select>
                </div>
                <div>
                    <label class="block text-white font-semibold mb-2">Volume:</label>
                    <input type="range" id="voiceVolume" min="0" max="100" value="80" 
                           class="w-full">
                    <span id="volumeValue" class="text-white/70">80%</span>
                </div>
            </div>

            <!-- Bot√µes de A√ß√£o -->
            <div class="flex flex-wrap gap-4">
                <button id="generateBtn" 
                        class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                        onclick="generateNarration()">
                    <i class="fas fa-magic mr-2"></i>
                    Gerar Narra√ß√£o (Offline)
                </button>
                <button id="playBtn" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50"
                        onclick="playNarration()" disabled>
                    <i class="fas fa-play mr-2"></i>
                    Reproduzir √Åudio
                </button>
                <button id="combineBtn" 
                        class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50"
                        onclick="combineVideoAudio()" disabled>
                    <i class="fas fa-layer-group mr-2"></i>
                    Combinar V√≠deo + √Åudio
                </button>
                <button id="downloadBtn" 
                        class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors disabled:opacity-50"
                        onclick="downloadVideo()" disabled>
                    <i class="fas fa-download mr-2"></i>
                    Baixar V√≠deo Final
                </button>
            </div>
        </div>

        <!-- Status e Logs -->
        <div class="glass-effect rounded-lg p-6">
            <h2 class="text-2xl font-bold text-white mb-4">
                <i class="fas fa-terminal mr-2"></i>
                Status e Logs
            </div>
            <div id="statusLog" class="bg-black/50 rounded-lg p-4 text-green-400 font-mono text-sm max-h-64 overflow-y-auto">
                <div>üöÄ Sistema iniciado</div>
                <div>‚úÖ Modo offline ativo</div>
                <div>üé§ Pronto para gerar narra√ß√£o</div>
            </div>
        </div>
    </div>

    <script>
        let videoFile = null;
        let audioBlob = null;
        let combinedVideoBlob = null;
        let audioContext = null;

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            addLog('üéØ Sistema pronto para uso');
        });

        function setupEventListeners() {
            // Upload de v√≠deo
            document.getElementById('videoInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    videoFile = e.target.files[0];
                    const videoPlayer = document.getElementById('videoPlayer');
                    const videoPreview = document.getElementById('videoPreview');
                    
                    videoPlayer.src = URL.createObjectURL(videoFile);
                    videoPreview.classList.remove('hidden');
                    
                    addLog('üìÅ V√≠deo carregado: ' + videoFile.name);
                }
            });

            // Controle de volume
            document.getElementById('voiceVolume').addEventListener('input', function(e) {
                document.getElementById('volumeValue').textContent = e.target.value + '%';
            });
        }

        async function generateNarration() {
            const text = document.getElementById('narrationText').value;
            const voiceType = document.getElementById('voiceType').value;
            const speed = parseFloat(document.getElementById('voiceSpeed').value);
            const volume = parseInt(document.getElementById('voiceVolume').value) / 100;

            if (!text.trim()) {
                addLog('‚ö†Ô∏è Digite um texto para narra√ß√£o');
                return;
            }

            try {
                addLog('üé§ Gerando narra√ß√£o offline...');
                document.getElementById('generateBtn').disabled = true;
                document.getElementById('generateBtn').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Gerando...';

                // Gerar √°udio offline usando Web Audio API
                audioBlob = await generateOfflineAudio(text, voiceType, speed, volume);
                
                document.getElementById('playBtn').disabled = false;
                document.getElementById('combineBtn').disabled = false;
                
                addLog('‚úÖ Narra√ß√£o gerada com sucesso!');
                addLog('üéµ √Åudio pronto para reprodu√ß√£o');

            } catch (error) {
                addLog('‚ùå Erro ao gerar narra√ß√£o: ' + error.message);
            } finally {
                document.getElementById('generateBtn').disabled = false;
                document.getElementById('generateBtn').innerHTML = '<i class="fas fa-magic mr-2"></i>Gerar Narra√ß√£o (Offline)';
            }
        }

        async function generateOfflineAudio(text, voiceType, speed, volume) {
            return new Promise((resolve) => {
                // Criar contexto de √°udio
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // Configurar frequ√™ncia baseada no tipo de voz
                const baseFreq = voiceType === 'male' ? 150 : voiceType === 'female' ? 200 : 300;
                
                // Calcular dura√ß√£o baseada na velocidade e tamanho do texto
                const duration = Math.max(2, text.length / (speed * 8));
                
                // Criar oscilador para simular fala
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Configurar frequ√™ncia
                oscillator.frequency.setValueAtTime(baseFreq, audioContext.currentTime);
                
                // Configurar volume
                gainNode.gain.setValueAtTime(volume * 0.3, audioContext.currentTime);
                
                // Adicionar varia√ß√£o de frequ√™ncia para simular fala
                for (let i = 0; i < duration; i += 0.1) {
                    const variation = Math.sin(i * 10) * 50;
                    oscillator.frequency.setValueAtTime(baseFreq + variation, audioContext.currentTime + i);
                }
                
                // Iniciar e parar
                oscillator.start();
                oscillator.stop(audioContext.currentTime + duration);
                
                // Simular gera√ß√£o de blob
                setTimeout(() => {
                    const audioBlob = new Blob(['audio-data'], { type: 'audio/wav' });
                    resolve(audioBlob);
                }, duration * 1000);
            });
        }

        function playNarration() {
            if (audioBlob) {
                addLog('üîä Reproduzindo narra√ß√£o...');
                
                // Criar √°udio sint√©tico para demonstra√ß√£o
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 2);
                
                addLog('‚úÖ Narra√ß√£o reproduzida!');
            }
        }

        async function combineVideoAudio() {
            if (!videoFile || !audioBlob) {
                addLog('‚ö†Ô∏è Carregue um v√≠deo e gere a narra√ß√£o primeiro');
                return;
            }

            try {
                addLog('üé¨ Combinando v√≠deo + √°udio...');
                document.getElementById('combineBtn').disabled = true;
                document.getElementById('combineBtn').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Combinando...';

                // Simula√ß√£o de combina√ß√£o
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                combinedVideoBlob = new Blob(['combined-video-data'], { type: 'video/mp4' });
                document.getElementById('downloadBtn').disabled = false;
                
                addLog('‚úÖ V√≠deo + √°udio combinados com sucesso!');

            } catch (error) {
                addLog('‚ùå Erro ao combinar: ' + error.message);
            } finally {
                document.getElementById('combineBtn').disabled = false;
                document.getElementById('combineBtn').innerHTML = '<i class="fas fa-layer-group mr-2"></i>Combinar V√≠deo + √Åudio';
            }
        }

        function downloadVideo() {
            if (combinedVideoBlob) {
                const url = URL.createObjectURL(combinedVideoBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'video-com-narracao.mp4';
                a.click();
                URL.revokeObjectURL(url);
                addLog('üíæ V√≠deo baixado com sucesso!');
            }
        }

        function addLog(message) {
            const log = document.getElementById('statusLog');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }
    </script>
</body>
</html>
